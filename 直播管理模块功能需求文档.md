# 直播管理模块功能需求文档

## 1. 文档概述

### 1.1 文档目的
本文档详细描述人民城轨2.0平台独立直播模块的功能需求，用于指导研发团队开发和实现。该模块作为平台的一级功能模块（与文创管理功能平级），支持三种直播方式的创建、配置与管理，满足平台的多样化直播需求。

### 1.2 术语定义
| 术语 | 解释 |
|-----|------|
| 外部链接直播 | 通过外部平台进行直播，在本平台仅维护基本信息和状态的直播类型 |
| 微赞直播 | 基于微赞平台API进行创建和管理的直播类型，支持丰富的互动功能和配置项 |
| 关联展会直播 | 与平台现有展会功能关联的直播类型，在APP中展示展会直播页面 |
| 单场直播 | 单个时间点的单次直播活动 |
| 多场直播 | 多个时间点的系列直播活动 |

## 2. 功能需求

### 2.1 核心功能列表

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|-------|---------|---------|-------|
| F-001 | 直播类型选择 | 支持三种直播方式：外部链接直播、微赞直播、关联展会直播 | 高 |
| F-002 | 外部链接直播配置 | 配置直播状态、名称、开播时间、外部链接等信息 | 高 |
| F-003 | 微赞直播配置 | 配置微赞直播各项参数，包括直播名称、图片、时间等基本信息 | 高 |
| F-004 | 报名功能配置 | 针对微赞直播，配置是否支持报名及问卷星报名链接 | 高 |
| F-005 | 多场直播配置 | 针对微赞直播，配置单场/多场模式及对应链接 | 高 |
| F-006 | 会议资料管理 | 管理会议介绍、会议议程、会议资料等PDF文档，并配置下载权限 | 高 |
| F-007 | 关联展会配置 | 配置直播与展会的关联关系 | 高 |
| F-008 | 直播列表展示 | 展示所有直播信息，包括创建时间、创建人、状态等 | 高 |
| F-009 | 智能搜索功能 | 支持按直播名称、直播时间、直播类型、创建人等进行搜索和筛选 | 高 |
| F-010 | 直播编辑功能 | 支持编辑已有直播信息 | 高 |
| F-011 | 直播状态管理 | 支持直播的开始、结束等状态管理 | 高 |
| F-012 | 直播删除功能 | 支持删除已有直播记录 | 高 |

### 2.2 功能详细描述

#### 2.2.1 直播类型选择 (F-001)
- **功能描述**：在创建新直播时，提供三种直播方式的选择界面
- **输入**：用户选择的直播类型
- **输出**：根据选择的类型展示对应的配置表单
- **交互逻辑**：
  - 用户点击"新建直播"按钮
  - 系统弹出模态框，首先显示直播类型选择界面
  - 用户选择直播类型后，系统动态加载对应类型的配置表单

#### 2.2.2 外部链接直播配置 (F-002)
- **功能描述**：配置外部链接直播的基本信息
- **输入**：
  - 直播名称（必填）
  - 开播时间（必填）
  - 外部直播链接（必填）
  - 直播封面图片（可选）
  - 直播简介（可选）
- **输出**：创建成功的外部链接直播记录
- **业务规则**：
  - 外部链接必须为有效的URL格式
  - 开播时间不能早于当前时间

#### 2.2.3 微赞直播配置 (F-003)
- **功能描述**：配置微赞直播的基本信息和微赞平台对接参数
- **输入**：
  - 直播名称（必填）
  - 开播时间（必填）
  - 主讲人（必填）
  - 所属频道（必填）
  - 直播封面图片（必填）
  - 直播简介（可选）
  - 画质设置（可选）
  - 码率设置（可选）
- **输出**：通过微赞API创建的直播记录
- **业务规则**：
  - 系统将通过微赞API自动创建对应的直播话题
  - 自动生成推流地址和推流密钥

#### 2.2.4 报名功能配置 (F-004)
- **功能描述**：针对微赞直播，配置是否开启报名功能及相关参数
- **输入**：
  - 是否开启报名（开关）
  - 问卷星报名链接（若开启报名则必填）
- **输出**：更新后的直播配置
- **业务规则**：
  - 若开启报名，必须提供有效的问卷星报名链接
  - APP端将显示报名按钮及问卷星报名界面

#### 2.2.5 多场直播配置 (F-005)
- **功能描述**：针对微赞直播，配置单场或多场直播模式
- **输入**：
  - 直播模式选择：单场/多场
  - 若选择多场，需配置每场直播的名称、时间、链接等信息
- **输出**：更新后的直播配置
- **业务规则**：
  - 多场直播时，需至少配置一场直播信息
  - 每场直播的时间不能重叠

#### 2.2.6 会议资料管理 (F-006)
- **功能描述**：管理会议介绍、会议议程、会议资料等PDF文档
- **输入**：
  - 会议介绍PDF文件（可选）
  - 会议议程PDF文件（可选）
  - 会议资料PDF文件（可选）
  - 各PDF文件的下载权限控制（可选）
- **输出**：上传成功的文件及配置信息
- **业务规则**：
  - 仅支持PDF格式文件，单文件大小不超过50MB
  - 单场直播时，PDF文件直接显示；多场直播时，PDF文件按列表形式展示
  - 可单独控制每个文件是否允许下载

#### 2.2.7 关联展会配置 (F-007)
- **功能描述**：配置直播与展会的关联关系
- **输入**：
  - 选择关联的展会（下拉选择）
- **输出**：更新后的直播配置
- **业务规则**：
  - 只能关联已存在的展会
  - 关联展会不会改变直播的展示路径，只是建立逻辑关联关系

#### 2.2.8 直播列表展示 (F-008)
- **功能描述**：以表格形式展示所有直播信息
- **展示字段**：
  - 直播ID
  - 直播名称
  - 直播类型
  - 开播时间
  - 状态
  - 创建时间
  - 创建人
  - 操作按钮（详情、编辑、删除、开播、结束直播等）
- **交互逻辑**：
  - 支持分页
  - 支持按状态、类型等进行筛选
  - 搜索条件与列表显示字段保持一致

#### 2.2.9 智能搜索功能 (F-009)
- **功能描述**：支持多维度搜索和筛选直播
- **搜索条件**：
  - 直播名称（关键字搜索）
  - 直播时间范围（日期选择器）
  - 直播类型（下拉选择）
  - 创建人（下拉选择）
  - 状态（下拉选择）
- **交互逻辑**：
  - 支持多条件组合搜索
  - 支持搜索条件的清除
  - 搜索结果实时更新

#### 2.2.10 直播编辑功能 (F-010)
- **功能描述**：支持编辑已创建的直播信息
- **输入**：编辑后的直播信息
- **输出**：更新成功的直播记录
- **业务规则**：
  - 已开始的直播不允许修改部分关键信息（如直播类型、开播时间等）
  - 微赞直播信息修改后需同步至微赞平台

#### 2.2.11 直播状态管理 (F-011)
- **功能描述**：管理直播的各种状态
- **支持的操作**：
  - 开始直播
  - 结束直播
  - 生成回放
  - 刷新状态
- **业务规则**：
  - 只有未开始的直播可以执行"开始直播"操作
  - 只有进行中的直播可以执行"结束直播"操作
  - 只有已结束的直播可以执行"生成回放"操作
  - 微赞直播的状态操作需调用微赞API

#### 2.2.12 直播删除功能 (F-012)
- **功能描述**：支持删除已有直播记录
- **输入**：用户确认删除操作
- **输出**：删除成功的直播记录
- **业务规则**：
  - 进行中的直播不允许删除
  - 删除操作需二次确认
  - 删除直播时同时删除相关的场次信息和会议资料
  - 微赞直播删除时需调用微赞API同步删除

## 3. 数据结构设计

### 3.1 直播主表 (live_management)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | BIGINT | PRIMARY KEY | 直播ID |
| title | VARCHAR(255) | NOT NULL | 直播名称 |
| type | VARCHAR(50) | NOT NULL | 直播类型 (external/weizan/exhibition) |
| status | VARCHAR(50) | NOT NULL | 直播状态 (not_started/live/ended) |
| start_time | DATETIME | NOT NULL | 开播时间 |
| end_time | DATETIME | NULL | 结束时间 |
| cover_url | VARCHAR(500) | NULL | 直播封面图片URL |
| description | TEXT | NULL | 直播简介 |
| external_url | VARCHAR(500) | NULL | 外部直播链接 (当type为external时必填) |
| exhibition_id | BIGINT | NULL | 关联展会ID (当type为exhibition时必填) |
| weizan_topic_id | VARCHAR(255) | NULL | 微赞话题ID (当type为weizan时必填) |
| presenter | VARCHAR(100) | NULL | 主讲人 (当type为weizan时必填) |
| channel_id | BIGINT | NULL | 所属频道ID (当type为weizan时必填) |
| enable_registration | BOOLEAN | DEFAULT FALSE | 是否开启报名 (当type为weizan时有效) |
| registration_url | VARCHAR(500) | NULL | 问卷星报名链接 (当enable_registration为true时必填) |
| is_multiple_sessions | BOOLEAN | DEFAULT FALSE | 是否多场直播 (当type为weizan时有效) |
| created_at | DATETIME | NOT NULL | 创建时间 |
| created_by | VARCHAR(100) | NOT NULL | 创建人 |
| updated_at | DATETIME | NOT NULL | 更新时间 |
| updated_by | VARCHAR(100) | NOT NULL | 更新人 |

### 3.2 直播场次表 (live_sessions) (当is_multiple_sessions为true时使用)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | BIGINT | PRIMARY KEY | 场次ID |
| live_id | BIGINT | FOREIGN KEY | 关联直播ID |
| session_name | VARCHAR(255) | NOT NULL | 场次名称 |
| session_time | DATETIME | NOT NULL | 场次时间 |
| session_url | VARCHAR(500) | NOT NULL | 场次直播链接 |
| created_at | DATETIME | NOT NULL | 创建时间 |

### 3.3 会议资料表 (meeting_materials)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | BIGINT | PRIMARY KEY | 资料ID |
| live_id | BIGINT | FOREIGN KEY | 关联直播ID |
| material_type | VARCHAR(50) | NOT NULL | 资料类型 (introduction/agenda/materials) |
| file_name | VARCHAR(255) | NOT NULL | 文件名称 |
| file_url | VARCHAR(500) | NOT NULL | 文件URL |
| allow_download | BOOLEAN | DEFAULT TRUE | 是否允许下载 |
| created_at | DATETIME | NOT NULL | 创建时间 |

## 4. 业务流程

### 4.1 直播创建流程
1. 用户点击"新建直播"按钮
2. 系统显示直播类型选择界面
3. 用户选择直播类型（外部链接直播/微赞直播/关联展会直播）
4. 系统根据选择的类型显示对应的配置表单
5. 用户填写表单信息
6. 用户点击"保存"按钮
7. 系统进行表单验证
8. 系统提交表单数据，创建直播记录
   - 对于微赞直播，调用微赞API创建直播话题
   - 对于关联展会直播，验证展会存在性
9. 系统显示创建成功提示，并刷新直播列表

### 4.2 直播管理流程
1. 用户进入直播管理页面
2. 系统显示直播列表
3. 用户可以通过搜索和筛选查找特定直播
4. 用户可以对列表中的直播进行操作：
   - 查看详情
   - 编辑信息
   - 开始/结束直播
   - 生成回放
   - 刷新状态

### 4.3 平台端直播访问流程
1. 用户在管理后台左侧菜单点击"直播管理"模块
2. 系统显示直播列表页面
3. 用户可以通过搜索和筛选查找特定直播
4. 用户可以对列表中的直播进行操作：
   - 查看详情
   - 编辑信息
   - 删除直播
   - 开始/结束直播（针对微赞直播）
   - 生成回放（针对微赞直播）
   - 刷新状态（针对微赞直播）

## 5. 异常处理机制

### 5.1 表单验证异常
- 输入数据不符合规则时，显示错误提示
- 关键必填项未填写时，阻止表单提交

### 5.2 API调用异常
- 微赞API调用失败时，显示友好的错误提示
- 记录错误日志，便于问题排查

### 5.3 文件上传异常
- 文件格式不符合要求时，显示错误提示
- 文件大小超出限制时，显示错误提示
- 上传失败时，提供重试选项

### 5.4 权限验证异常
- 未授权用户尝试执行管理操作时，显示无权限提示

## 6. 界面原型

### 6.1 直播列表页
- 左侧：平台主菜单，包含"直播管理"一级菜单
- 顶部：页面标题、操作按钮（新建直播、刷新数据）
- 中部：搜索和筛选区域（搜索条件与列表显示字段一致）
- 底部：直播列表表格，包含操作列（详情、编辑、删除等）

### 6.2 新建/编辑直播模态框
- 顶部：标题（新建直播/编辑直播）
- 第一步：直播类型选择
- 第二步：根据类型显示不同配置表单
- 底部：操作按钮（保存、取消）

## 7. 性能要求

### 7.1 页面响应时间
- 直播列表页面加载时间 < 2秒
- 直播创建/编辑表单加载时间 < 1秒
- 搜索结果响应时间 < 1秒

### 7.2 并发处理能力
- 支持500用户同时访问直播管理模块
- 支持100用户同时进行直播创建/编辑操作
- 支持大数据量（1000+）直播记录的流畅展示和搜索

## 8. 安全要求

### 8.1 数据安全
- 敏感数据传输采用HTTPS加密
- 防止SQL注入攻击

### 8.2 权限控制
- 基于角色的访问控制
- 操作日志记录

## 9. 验收标准

1. 能成功创建三种类型的直播
2. 直播配置信息能正确保存和展示
3. APP端能正确显示不同类型的直播页面
4. 会议资料能正确上传、展示，并能控制下载权限
5. 搜索和筛选功能能准确返回结果
6. 直播状态操作能正确执行
7. 系统能正确处理各种异常情况

## 10. 风险评估

| 风险点 | 可能性 | 影响程度 | 缓解措施 |
|-------|-------|---------|--------|
| 微赞API接口不稳定 | 中 | 高 | 增加重试机制，完善错误处理 |
| PDF文件上传失败 | 低 | 中 | 提供重试选项，优化上传机制 |
| 直播状态同步延迟 | 中 | 中 | 增加手动刷新功能 |
| 多场直播场次信息管理复杂 | 低 | 高 | 提供清晰的场次管理界面，添加批量操作功能 |

## 11. 附录

### 11.1 参考文档
- 微赞开放平台API文档
- 人民城轨2.0平台技术规范

### 11.2 相关资源
- APP端直播界面设计稿
- 微赞平台对接指南