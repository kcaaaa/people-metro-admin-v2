<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大屏管理 - 富文本编辑器 Demo</title>
    
    <!-- Quill 富文本编辑器 CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    
    <!-- FontAwesome 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* 头部样式 */
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 24px 32px;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-title i {
            font-size: 28px;
        }

        .header-title h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 4px;
        }

        /* 主内容区域 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            padding: 32px;
        }

        .editor-section,
        .preview-section {
            display: flex;
            flex-direction: column;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #2a5298;
        }

        .section-header i {
            color: #2a5298;
            font-size: 20px;
        }

        .section-header h2 {
            font-size: 18px;
            color: #1e3c72;
            font-weight: 600;
        }

        /* 工具栏样式 */
        .toolbar-container {
            background: #f5f7fa;
            padding: 12px;
            border-radius: 8px 8px 0 0;
            border: 1px solid #e4e7ed;
            border-bottom: none;
        }

        .custom-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .toolbar-group {
            display: flex;
            gap: 4px;
            padding: 4px 8px;
            background: #ffffff;
            border-radius: 6px;
            border: 1px solid #dcdfe6;
        }

        .toolbar-button {
            padding: 6px 12px;
            background: #ffffff;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            color: #606266;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toolbar-button:hover {
            background: #2a5298;
            color: #ffffff;
            border-color: #2a5298;
        }

        .toolbar-button i {
            font-size: 14px;
        }

        /* 编辑器样式 */
        #editor {
            min-height: 500px;
            background: #ffffff;
            border: 1px solid #e4e7ed;
            border-radius: 0 0 8px 8px;
        }

        .ql-container {
            font-size: 16px;
            min-height: 500px;
        }

        .ql-editor {
            min-height: 500px;
            padding: 20px;
        }

        /* 预览区域样式 */
        .preview-container {
            min-height: 500px;
            background: #ffffff;
            border: 1px solid #e4e7ed;
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
            max-height: 600px;
        }

        .preview-content {
            line-height: 1.8;
            color: #303133;
        }

        /* 图片样式 - 支持多种对齐方式 */
        .preview-content img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin: 12px 0;
        }

        .ql-editor img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .ql-editor img:hover {
            box-shadow: 0 4px 12px rgba(42, 82, 152, 0.3);
            transform: scale(1.02);
        }
        
        .ql-editor img::after {
            content: '点击设置布局';
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(42, 82, 152, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .ql-editor img:hover::after {
            opacity: 1;
        }

        /* 图片布局样式 */
        .ql-editor .img-layout-left,
        .preview-content .img-layout-left {
            float: left;
            margin: 8px 20px 12px 0;
            max-width: 45%;
        }

        .ql-editor .img-layout-right,
        .preview-content .img-layout-right {
            float: right;
            margin: 8px 0 12px 20px;
            max-width: 45%;
        }

        .ql-editor .img-layout-center,
        .preview-content .img-layout-center {
            display: block;
            margin: 16px auto;
            max-width: 70%;
        }

        .ql-editor .img-layout-full,
        .preview-content .img-layout-full {
            display: block;
            margin: 16px 0;
            max-width: 100%;
            width: 100%;
        }
        
        /* 布局选择对话框样式 */
        .layout-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .layout-dialog {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            animation: slideUp 0.3s;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .layout-dialog-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .layout-dialog-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .layout-dialog-header .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .layout-dialog-header .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        
        .layout-dialog-body {
            padding: 32px 24px;
        }
        
        .layout-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .layout-option {
            border: 2px solid #e4e7ed;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .layout-option:hover {
            border-color: #2a5298;
            box-shadow: 0 4px 12px rgba(42, 82, 152, 0.2);
            transform: translateY(-4px);
        }
        
        .layout-preview {
            background: #f5f7fa;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 12px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .preview-img {
            background: #2a5298;
            border-radius: 4px;
        }
        
        .preview-img.left {
            width: 40px;
            height: 40px;
            float: left;
            margin-right: 8px;
        }
        
        .preview-img.right {
            width: 40px;
            height: 40px;
            float: right;
            margin-left: 8px;
        }
        
        .preview-img.center {
            width: 50px;
            height: 40px;
            margin: 0 auto 8px auto;
        }
        
        .preview-img.full {
            width: 100%;
            height: 40px;
        }
        
        .preview-text {
            flex: 1;
        }
        
        .preview-text.center {
            width: 100%;
        }
        
        .text-line {
            height: 4px;
            background: #dcdfe6;
            border-radius: 2px;
            margin-bottom: 4px;
        }
        
        .text-line:last-child {
            margin-bottom: 0;
            width: 60%;
        }
        
        .layout-name {
            font-size: 14px;
            color: #303133;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .layout-name i {
            color: #2a5298;
        }
        
        .layout-tips {
            background: #ecf5ff;
            border: 1px solid #b3d8ff;
            border-radius: 6px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: #409eff;
        }
        
        .layout-tips i {
            font-size: 16px;
        }

        /* 操作按钮区域 */
        .action-buttons {
            display: flex;
            gap: 12px;
            padding: 24px 32px;
            background: #f5f7fa;
            border-top: 1px solid #e4e7ed;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: #ffffff;
        }

        .btn-primary:hover {
            box-shadow: 0 4px 12px rgba(42, 82, 152, 0.4);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #ffffff;
            color: #606266;
            border: 1px solid #dcdfe6;
        }

        .btn-secondary:hover {
            background: #f5f7fa;
            border-color: #2a5298;
            color: #2a5298;
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* 自定义 Quill 工具栏样式 */
        .ql-toolbar.ql-snow {
            border: none;
            background: transparent;
            padding: 8px 0;
        }

        .ql-toolbar.ql-snow .ql-formats {
            margin-right: 12px;
        }

        .ql-snow .ql-stroke {
            stroke: #606266;
        }

        .ql-snow .ql-fill {
            fill: #606266;
        }

        .ql-snow .ql-picker-label {
            color: #606266;
        }

        .ql-toolbar.ql-snow .ql-picker-label:hover,
        .ql-toolbar.ql-snow button:hover {
            color: #2a5298;
        }

        .ql-toolbar.ql-snow .ql-picker-label:hover .ql-stroke,
        .ql-toolbar.ql-snow button:hover .ql-stroke {
            stroke: #2a5298;
        }

        .ql-toolbar.ql-snow .ql-picker-label:hover .ql-fill,
        .ql-toolbar.ql-snow button:hover .ql-fill {
            fill: #2a5298;
        }

        /* 提示信息 */
        .tips-container {
            background: #ecf5ff;
            border: 1px solid #b3d8ff;
            border-radius: 8px;
            padding: 16px;
            margin: 0 32px 24px 32px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .tips-container i {
            color: #409eff;
            font-size: 18px;
            margin-top: 2px;
        }

        .tips-content {
            flex: 1;
        }

        .tips-title {
            font-size: 14px;
            font-weight: 600;
            color: #409eff;
            margin-bottom: 8px;
        }

        .tips-list {
            font-size: 13px;
            color: #606266;
            line-height: 1.8;
            padding-left: 20px;
        }

        .tips-list li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <div class="header-title">
                <i class="fa-solid fa-desktop"></i>
                <div>
                    <h1>大屏管理 - 富文本编辑器</h1>
                    <div class="header-subtitle">支持图文混排，图片可自由定位</div>
                </div>
            </div>
        </div>

        <!-- 提示信息 -->
        <div class="tips-container">
            <i class="fa-solid fa-circle-info"></i>
            <div class="tips-content">
                <div class="tips-title">功能说明</div>
                <ul class="tips-list">
                    <li>支持富文本编辑：粗体、斜体、下划线、标题、列表等</li>
                    <li>支持图片插入：点击工具栏的图片按钮上传图片</li>
                    <li><strong>智能图片布局</strong>：插入图片后自动弹出布局选择器，支持4种布局方式</li>
                    <li>灵活调整布局：点击已插入的图片可随时重新选择布局方式</li>
                    <li>实时预览：右侧实时显示编辑效果，所见即所得</li>
                    <li>支持导出：可导出 HTML 内容用于大屏展示</li>
                </ul>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <!-- 编辑器区域 -->
            <div class="editor-section">
                <div class="section-header">
                    <i class="fa-solid fa-pen-to-square"></i>
                    <h2>内容编辑</h2>
                </div>
                
                <div class="toolbar-container">
                    <div id="toolbar">
                        <!-- 工具栏将由 Quill 自动生成 -->
                    </div>
                </div>
                
                <div id="editor"></div>
            </div>

            <!-- 预览区域 -->
            <div class="preview-section">
                <div class="section-header">
                    <i class="fa-solid fa-eye"></i>
                    <h2>实时预览</h2>
                </div>
                
                <div class="preview-container">
                    <div class="preview-content" id="preview">
                        <p>在左侧编辑器中输入内容，这里将实时显示预览效果...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 操作按钮 -->
        <div class="action-buttons">
            <button class="btn btn-secondary" onclick="clearContent()">
                <i class="fa-solid fa-trash"></i>
                清空内容
            </button>
            <button class="btn btn-secondary" onclick="exportHTML()">
                <i class="fa-solid fa-download"></i>
                导出 HTML
            </button>
            <button class="btn btn-primary" onclick="saveContent()">
                <i class="fa-solid fa-floppy-disk"></i>
                保存内容
            </button>
        </div>
    </div>

    <!-- Quill 富文本编辑器 JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    
    <script>
        // 初始化 Quill 编辑器
        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: {
                    container: '#toolbar',
                    handlers: {
                        image: imageHandler
                    }
                }
            },
            placeholder: '请输入内容，支持图文混排...'
        });

        // 自定义工具栏配置
        var toolbarOptions = [
            // 文本格式
            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
            [{ 'size': ['small', false, 'large', 'huge'] }],
            
            // 字体样式
            ['bold', 'italic', 'underline', 'strike'],
            [{ 'color': [] }, { 'background': [] }],
            
            // 对齐方式
            [{ 'align': [] }],
            
            // 列表
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            [{ 'indent': '-1'}, { 'indent': '+1' }],
            
            // 插入
            ['link', 'image', 'video'],
            
            // 清除格式
            ['clean']
        ];

        // 重新初始化编辑器以应用自定义工具栏
        quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: {
                    container: toolbarOptions,
                    handlers: {
                        image: imageHandler
                    }
                }
            },
            placeholder: '请输入内容，支持图文混排...'
        });

        // 自定义图片处理函数
        function imageHandler() {
            const input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'image/*');
            input.click();

            input.onchange = async () => {
                const file = input.files[0];
                if (file) {
                    // 这里可以上传到服务器，现在使用 base64 预览
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const range = quill.getSelection();
                        quill.insertEmbed(range.index, 'image', e.target.result);
                        
                        // 插入图片后显示布局选择弹窗
                        setTimeout(() => {
                            showImageLayoutDialog(range.index);
                        }, 100);
                    };
                    reader.readAsDataURL(file);
                }
            };
        }
        
        // 显示图片布局选择对话框
        function showImageLayoutDialog(imageIndex) {
            // 创建遮罩层
            const overlay = document.createElement('div');
            overlay.className = 'layout-dialog-overlay';
            overlay.innerHTML = `
                <div class="layout-dialog" onclick="event.stopPropagation()">
                    <div class="layout-dialog-header">
                        <h3><i class="fa-solid fa-image"></i> 选择图片布局方式</h3>
                        <button class="close-btn" onclick="closeLayoutDialog()">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                    <div class="layout-dialog-body">
                        <div class="layout-options">
                            <div class="layout-option" onclick="applyImageLayout(${imageIndex}, 'left')">
                                <div class="layout-preview">
                                    <div class="preview-img left"></div>
                                    <div class="preview-text">
                                        <div class="text-line"></div>
                                        <div class="text-line"></div>
                                        <div class="text-line"></div>
                                    </div>
                                </div>
                                <div class="layout-name">
                                    <i class="fa-solid fa-align-left"></i>
                                    左对齐（文字环绕右侧）
                                </div>
                            </div>
                            
                            <div class="layout-option" onclick="applyImageLayout(${imageIndex}, 'center')">
                                <div class="layout-preview">
                                    <div class="preview-img center"></div>
                                    <div class="preview-text center">
                                        <div class="text-line"></div>
                                        <div class="text-line"></div>
                                    </div>
                                </div>
                                <div class="layout-name">
                                    <i class="fa-solid fa-align-center"></i>
                                    居中对齐
                                </div>
                            </div>
                            
                            <div class="layout-option" onclick="applyImageLayout(${imageIndex}, 'right')">
                                <div class="layout-preview">
                                    <div class="preview-img right"></div>
                                    <div class="preview-text">
                                        <div class="text-line"></div>
                                        <div class="text-line"></div>
                                        <div class="text-line"></div>
                                    </div>
                                </div>
                                <div class="layout-name">
                                    <i class="fa-solid fa-align-right"></i>
                                    右对齐（文字环绕左侧）
                                </div>
                            </div>
                            
                            <div class="layout-option" onclick="applyImageLayout(${imageIndex}, 'full')">
                                <div class="layout-preview">
                                    <div class="preview-img full"></div>
                                </div>
                                <div class="layout-name">
                                    <i class="fa-solid fa-expand"></i>
                                    全宽显示
                                </div>
                            </div>
                        </div>
                        
                        <div class="layout-tips">
                            <i class="fa-solid fa-lightbulb"></i>
                            <span>提示：插入图片后可随时点击图片重新选择布局方式</span>
                        </div>
                    </div>
                </div>
            `;
            
            // 点击遮罩层关闭对话框
            overlay.addEventListener('click', closeLayoutDialog);
            
            document.body.appendChild(overlay);
        }
        
        // 关闭布局选择对话框
        function closeLayoutDialog() {
            const overlay = document.querySelector('.layout-dialog-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // 应用图片布局
        function applyImageLayout(imageIndex, layout) {
            const editor = document.querySelector('.ql-editor');
            const images = editor.querySelectorAll('img');
            
            if (imageIndex < images.length) {
                const img = images[imageIndex];
                
                // 移除所有布局类
                img.classList.remove('img-layout-left', 'img-layout-right', 'img-layout-center', 'img-layout-full');
                
                // 应用新布局
                img.classList.add(`img-layout-${layout}`);
                img.setAttribute('data-layout', layout);
                
                // 更新预览
                updatePreview();
            }
            
            // 关闭对话框
            closeLayoutDialog();
        }
        
        // 为编辑器中的图片添加点击事件
        function initImageClickHandler() {
            const editor = document.querySelector('.ql-editor');
            
            editor.addEventListener('click', function(e) {
                if (e.target.tagName === 'IMG') {
                    const images = Array.from(editor.querySelectorAll('img'));
                    const imageIndex = images.indexOf(e.target);
                    
                    if (imageIndex !== -1) {
                        showImageLayoutDialog(imageIndex);
                    }
                }
            });
        }

        // 监听内容变化，实时更新预览
        quill.on('text-change', function() {
            updatePreview();
        });

        // 更新预览
        function updatePreview() {
            const content = quill.root.innerHTML;
            document.getElementById('preview').innerHTML = content;
        }

        // 清空内容
        function clearContent() {
            if (confirm('确定要清空所有内容吗？')) {
                quill.setText('');
                updatePreview();
            }
        }

        // 导出 HTML
        function exportHTML() {
            const content = quill.root.innerHTML;
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '大屏内容_' + new Date().getTime() + '.html';
            a.click();
            URL.revokeObjectURL(url);
            
            // 显示成功提示
            alert('HTML 内容已导出！');
        }

        // 保存内容
        function saveContent() {
            const content = quill.root.innerHTML;
            
            // 这里可以发送到后端保存
            console.log('保存的内容：', content);
            
            // 模拟保存到 localStorage
            localStorage.setItem('screenContent', content);
            localStorage.setItem('screenContentTime', new Date().toLocaleString());
            
            alert('内容已保存！');
        }

        // 页面加载时恢复之前保存的内容
        window.onload = function() {
            // 初始化图片点击事件
            initImageClickHandler();
            
            const savedContent = localStorage.getItem('screenContent');
            if (savedContent) {
                const savedTime = localStorage.getItem('screenContentTime');
                if (confirm('检测到之前保存的内容（' + savedTime + '），是否恢复？')) {
                    quill.root.innerHTML = savedContent;
                    updatePreview();
                }
            }
            
            // 加载示例内容
            loadExampleContent();
        };

        // 加载示例内容
        function loadExampleContent() {
            const exampleContent = `
                <h2>中国城市轨道交通协会章程（修正案）</h2>
                <p>该章程共九章第81条，2023年2月6日经民政部核准生效。明确协会为全国性、行业性社会团体，住所设在北京，坚持党的全面领导，接受业务主管单位、行业管理部门的业务指导和监督管理。</p>
                <p><strong>章程规定协会业务范围广泛</strong>，通盖政策宣传、行业调研、行标行约制定、统计、人才培养、表彰建设、老年活动证、职称评审、行业活动举办、专业咨询、国际交流等。</p>
                <p>会员分为单位与个人会员，明确入会条件、程序、权利与义务、管理与章程。交纳黄费与义务。</p>
                <h3>组织机构与管理</h3>
                <p>组织机构包含会员大会（每5年召开，为权力机构）、理事会（执行机构、每届5年）、常务理事会（闭会期间行使部分职权）、负责人（设轮值会长、副会长、秘书长，执行秘书长等）、各机构权责与选任制新明确。</p>
                <p>资产管理方面，明确收入来源、资产、执行国家规定的财务管理制度、接受监督等内容。</p>
            `;
            
            // 只在没有保存内容时加载示例
            if (!localStorage.getItem('screenContent')) {
                quill.root.innerHTML = exampleContent;
                updatePreview();
            }
        }
    </script>
</body>
</html>

