# 展会报名管理功能开发问题记录

## 文档说明

本文档用于记录展会报名管理功能在开发过程中遇到的各类问题、对应的解决方案以及经验总结。当前功能已简化为第三方平台报名入口管理，专注于配置宣传图、名称、链接和开关状态。

## 问题记录列表

| 问题ID | 问题描述 | 发现时间 | 解决状态 | 解决时间 | 负责人 | 解决方案 | 备注 |
|--------|----------|----------|----------|----------|--------|----------|------|
| PROB-NEW001 | 第三方报名链接有效性验证 | 2023-11-27 | 已解决 | 2023-11-27 | 开发团队 | 实现URL格式验证规则，使用正则表达式检查链接格式是否正确，确保链接包含http://或https://前缀 | - |
| PROB-NEW002 | 宣传图片上传与预览功能 | 2023-11-27 | 已解决 | 2023-11-27 | 开发团队 | 使用Ant Design的Upload组件实现图片上传，配置上传前验证图片类型和大小，并实现上传后的预览功能 | 支持常见图片格式，限制图片大小 |
| PROB-NEW003 | 报名开关状态即时生效问题 | 2023-11-27 | 已解决 | 2023-11-27 | 开发团队 | 使用React的useState管理开关状态，结合Ant Design的Switch组件实现即时切换效果，并在状态变更后立即保存配置 | 确保前端显示与数据库状态一致 |

## 详细问题记录

### PROB-NEW001: 第三方报名链接有效性验证

#### 问题描述
需要确保管理员配置的第三方报名链接是有效的URL格式，避免配置错误导致用户无法正常访问报名平台。

#### 解决方案
1. 实现URL格式验证规则，使用正则表达式检查链接格式
2. 确保链接必须包含http://或https://前缀
3. 添加实时验证提示，在用户输入时即时反馈格式是否正确

```javascript
// URL格式验证规则
const validateUrl = (rule, value, callback) => {
  if (!value) {
    callback('请输入报名链接');
  } else {
    const urlRegex = /^(https?:\/\/)([\da-z.-]+)\.([a-z.]{2,6})([/\w .-]*)*\/?$/;
    if (urlRegex.test(value)) {
      callback();
    } else {
      callback('请输入有效的URL，必须包含http://或https://');
    }
  }
};
```

### PROB-NEW002: 宣传图片上传与预览功能

#### 问题描述
需要实现宣传图片的上传功能，并在上传后提供预览，同时需要限制图片类型和大小，确保前端展示效果。

#### 解决方案
1. 使用Ant Design的Upload组件实现图片上传功能
2. 配置beforeUpload钩子函数，在上传前验证图片类型和大小
3. 实现图片预览功能，在上传后立即显示图片缩略图
4. 添加图片删除功能，允许管理员替换已有图片

```javascript
// 图片上传配置
const uploadProps = {
  beforeUpload: (file) => {
    // 验证图片类型
    const isImage = file.type.startsWith('image/');
    if (!isImage) {
      message.error('只能上传图片格式!');
      return Upload.LIST_IGNORE;
    }
    // 验证图片大小 (2MB)
    const isLt2M = file.size / 1024 / 1024 < 2;
    if (!isLt2M) {
      message.error('图片大小不能超过 2MB!');
      return Upload.LIST_IGNORE;
    }
    return true;
  },
  showUploadList: false,
  onChange: handleUploadChange,
};
```

### PROB-NEW003: 报名开关状态即时生效问题

#### 问题描述
需要确保报名开关状态的变更能够即时生效，前端界面上的显示状态与数据库中存储的状态保持一致。

#### 解决方案
1. 使用React的useState管理开关状态
2. 结合Ant Design的Switch组件实现即时切换效果
3. 在状态变更时立即调用保存接口，确保数据同步到后端
4. 添加加载状态提示，避免用户重复操作

```javascript
// 开关状态处理
const handleSwitchChange = async (checked) => {
  setIsLoading(true);
  try {
    // 保存开关状态到数据库
    await saveConfig({ ...config, enabled: checked });
    setConfig(prev => ({ ...prev, enabled: checked }));
    message.success('配置已更新');
  } catch (error) {
    message.error('更新失败，请重试');
    // 恢复原状态
    setConfig(prev => ({ ...prev, enabled: !checked }));
  } finally {
    setIsLoading(false);
  }
};
```

## 更新记录

| 更新时间 | 更新内容 | 更新人 |
|---------|---------|-------|
| 2023-11-27 | 简化文档内容，更新为第三方平台报名入口管理相关问题 | 系统管理员 |
