# 展会报名技术实现方案 - 展会管理系统

## 1. 项目概述

本技术方案基于《展会报名功能设计.md》和《展会报名UI设计方案.md》，并结合现有的展会管理系统，添加展会报名功能模块。该功能**与展会管理功能平级**，是一个独立的功能模块，主要用于管理展会报名信息、报名材料，支持统计分析和短信通知等功能。

## 2. 前端技术实现

### 2.1 技术栈

- React 17.0.2
- Ant Design 4.24.15
- ECharts 5.4.3
- Axios (用于API请求)

### 2.2 文件结构

参考现有的项目结构，建议新增以下文件：

```
src/js/
├── pages/
│   ├── ExhibitionManagement/
│   │   ├── BoothManagement.js          # 展位管理页面
│   │   └── ExhibitorManagement.js      # 展商管理页面
│   └── ExhibitionRegistrationManagement.js    # 展会报名主页面（与展会管理平级）
├── components/
│   └── ExhibitionRegistration/
│       ├── RegistrationList.js          # 报名列表组件
│       ├── RegistrationForm.js          # 报名表单组件
│       ├── RegistrationDetail.js        # 报名详情组件
│       ├── AuditModal.js                # 审核模态框组件
│       ├── ExportModal.js               # 导出设置模态框组件
│       ├── SmsModal.js                  # 短信发送模态框组件
│       └── StatisticsCard.js            # 统计卡片组件
├── services/
│   └── exhibitionRegistration.js        # API服务封装
└── utils/
    └── exhibitionRegistration.js        # 工具函数
```

> **注意**：根据最新调整，展会报名功能已从展会管理的子模块调整为**平级关系**，因此主页面文件直接放在pages目录下。

### 2.3 组件实现

#### 2.3.1 ExhibitionRegistrationManagement.js (主页面)

该组件作为展会报名功能的主入口，整合其他子组件。主要功能包括：

- 状态管理：维护报名列表数据、筛选条件、分页信息等
- 数据加载：调用API获取报名数据和统计信息
- 事件处理：处理搜索、筛选、排序、分页等事件
- 组件渲染：整合统计卡片、操作栏、数据表格等子组件

```javascript
// ExhibitionRegistrationManagement.js 核心结构示例
import React, { useState, useEffect } from 'react';
import { Card, Row, Col, Button, Input, Select, DatePicker, Table, Modal } from 'antd';
import { SearchOutlined, PlusOutlined, ExportOutlined, SendOutlined } from '@ant-design/icons';
import RegistrationList from '@/components/ExhibitionRegistration/RegistrationList';
import RegistrationForm from '@/components/ExhibitionRegistration/RegistrationForm';
import StatisticsCard from '@/components/ExhibitionRegistration/StatisticsCard';
import { fetchRegistrationData, fetchStatistics } from '@/services/exhibitionRegistration';

const ExhibitionRegistration = () => {
  // 状态管理
  const [registrationData, setRegistrationData] = useState([]);
  const [statistics, setStatistics] = useState({});
  const [loading, setLoading] = useState(false);
  const [searchText, setSearchText] = useState('');
  const [status, setStatus] = useState('all');
  const [dateRange, setDateRange] = useState([]);
  const [pagination, setPagination] = useState({ current: 1, pageSize: 10 });
  const [selectedRowKeys, setSelectedRowKeys] = useState([]);
  
  // 组件生命周期
  useEffect(() => {
    loadRegistrationData();
    loadStatistics();
  }, [status, dateRange, pagination]);
  
  // 加载报名数据
  const loadRegistrationData = async () => {
    // 实现数据加载逻辑
  };
  
  // 加载统计数据
  const loadStatistics = async () => {
    // 实现统计数据加载逻辑
  };
  
  // 搜索处理
  const handleSearch = () => {
    loadRegistrationData();
  };
  
  // 批量操作处理
  const handleBatchOperation = (type) => {
    // 实现批量审核、导出等操作
  };
  
  return (
    <div>
      {/* 统计卡片 */}
      <Row gutter={16} style={{ marginBottom: 16 }}>
        <StatisticsCard data={statistics} />
      </Row>
      
      {/* 操作栏 */}
      <Card style={{ marginBottom: 16 }}>
        {/* 搜索和筛选组件 */}
      </Card>
      
      {/* 数据表格 */}
      <RegistrationList 
        data={registrationData}
        loading={loading}
        pagination={pagination}
        selectedRowKeys={selectedRowKeys}
        onSelectChange={setSelectedRowKeys}
        onPageChange={setPagination}
        onViewDetail={handleViewDetail}
        onEdit={handleEdit}
        onAudit={handleAudit}
        onSendSms={handleSendSms}
      />
      
      {/* 模态框 */}
    </div>
  );
};

export default ExhibitionRegistration;
```

#### 2.3.2 RegistrationList.js (报名列表组件)

负责展示报名信息表格，支持多选、排序、分页等功能。

```javascript
// RegistrationList.js 核心结构示例
import React from 'react';
import { Table, Tag, Button, Space } from 'antd';
import { EyeOutlined, EditOutlined, CheckOutlined, CloseOutlined, MessageOutlined } from '@ant-design/icons';

const RegistrationList = ({ 
  data, 
  loading, 
  pagination, 
  selectedRowKeys, 
  onSelectChange, 
  onPageChange,
  onViewDetail,
  onEdit,
  onAudit,
  onSendSms
}) => {
  // 表格列定义
  const columns = [
    {
      title: '序号',
      dataIndex: 'id',
      key: 'id',
      width: 80,
    },
    {
      title: '公司名称',
      dataIndex: 'companyName',
      key: 'companyName',
    },
    {
      title: '联系人',
      dataIndex: 'contactName',
      key: 'contactName',
    },
    {
      title: '联系电话',
      dataIndex: 'contactPhone',
      key: 'contactPhone',
    },
    {
      title: '报名时间',
      dataIndex: 'registrationTime',
      key: 'registrationTime',
      sorter: (a, b) => new Date(a.registrationTime) - new Date(b.registrationTime),
    },
    {
      title: '审核状态',
      dataIndex: 'status',
      key: 'status',
      render: (status) => {
        // 状态标签渲染
        let color = 'default';
        let text = '未知';
        
        switch(status) {
          case 'pending':
            color = 'warning';
            text = '待审核';
            break;
          case 'approved':
            color = 'success';
            text = '已通过';
            break;
          case 'rejected':
            color = 'error';
            text = '未通过';
            break;
        }
        
        return <Tag color={color}>{text}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      render: (_, record) => (
        <Space size="middle">
          <Button icon={<EyeOutlined />} onClick={() => onViewDetail(record)} />
          <Button icon={<EditOutlined />} onClick={() => onEdit(record)} />
          <Button 
            icon={record.status === 'pending' ? <CheckOutlined /> : <CloseOutlined />} 
            onClick={() => onAudit(record)} 
            disabled={record.status !== 'pending'}
          />
          <Button icon={<MessageOutlined />} onClick={() => onSendSms(record)} />
        </Space>
      ),
    },
  ];
  
  // 行选择配置
  const rowSelection = {
    selectedRowKeys,
    onChange: onSelectChange,
  };
  
  return (
    <Table
      rowKey="id"
      columns={columns}
      dataSource={data}
      loading={loading}
      pagination={pagination}
      rowSelection={rowSelection}
      onChange={(newPagination) => onPageChange(newPagination)}
    />
  );
};

export default RegistrationList;
```

#### 2.3.3 API服务封装 (exhibitionRegistration.js)

封装与后端交互的API接口。

```javascript
// services/exhibitionRegistration.js
import request from '@/utils/request';

// 获取报名数据列表
export const fetchRegistrationData = (params) => {
  return request({
    url: '/api/exhibition/registration/list',
    method: 'get',
    params,
  });
};

// 获取报名统计数据
export const fetchStatistics = (params) => {
  return request({
    url: '/api/exhibition/registration/statistics',
    method: 'get',
    params,
  });
};

// 获取报名详情
export const fetchRegistrationDetail = (id) => {
  return request({
    url: `/api/exhibition/registration/${id}`,
    method: 'get',
  });
};

// 创建报名记录
export const createRegistration = (data) => {
  return request({
    url: '/api/exhibition/registration',
    method: 'post',
    data,
  });
};

// 更新报名记录
export const updateRegistration = (id, data) => {
  return request({
    url: `/api/exhibition/registration/${id}`,
    method: 'put',
    data,
  });
};

// 审核报名记录
export const auditRegistration = (id, data) => {
  return request({
    url: `/api/exhibition/registration/${id}/audit`,
    method: 'post',
    data,
  });
};

// 批量审核报名记录
export const batchAuditRegistration = (data) => {
  return request({
    url: '/api/exhibition/registration/batch-audit',
    method: 'post',
    data,
  });
};

// 导出报名数据
export const exportRegistrationData = (params) => {
  return request({
    url: '/api/exhibition/registration/export',
    method: 'get',
    params,
    responseType: 'blob',
  });
};

// 发送短信
export const sendSms = (data) => {
  return request({
    url: '/api/exhibition/registration/send-sms',
    method: 'post',
    data,
  });
};

// 上传材料
export const uploadMaterial = (formData) => {
  return request({
    url: '/api/exhibition/registration/upload',
    method: 'post',
    data: formData,
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
};
```

### 2.4 路由配置

在现有的路由配置中，为展会报名功能添加平级路由信息。

```javascript
// 主路由配置
const routes = [
  // 其他现有路由...
  
  // 展会管理相关路由（保持不变）
  {
    path: '/exhibition/booth',
    component: dynamicImport(() => import('@/pages/ExhibitionManagement/BoothManagement')),
    meta: { title: '展位管理' },
  },
  {
    path: '/exhibition/exhibitor',
    component: dynamicImport(() => import('@/pages/ExhibitionManagement/ExhibitorManagement')),
    meta: { title: '展商管理' },
  },
  
  // 新增展会报名路由（平级配置）
  {
    path: '/exhibition-registration',
    component: dynamicImport(() => import('@/pages/ExhibitionRegistrationManagement')),
    meta: { title: '展会报名' },
  },
];

// 或者如果使用exhibitionRoutes数组，调整为：
const exhibitionRoutes = [
  // 现有的展位管理路由
  {
    path: '/exhibition/booth',
    component: dynamicImport(() => import('@/pages/ExhibitionManagement/BoothManagement')),
    meta: { title: '展位管理' },
  },
  // 现有的展商管理路由
  {
    path: '/exhibition/exhibitor',
    component: dynamicImport(() => import('@/pages/ExhibitionManagement/ExhibitorManagement')),
    meta: { title: '展商管理' },
  },
];

// 然后在主路由配置中添加展会报名路由
const routes = [
  // 其他路由...
  ...exhibitionRoutes,
  // 展会报名路由（平级）
  {
    path: '/exhibition-registration',
    component: dynamicImport(() => import('@/pages/ExhibitionRegistrationManagement')),
    meta: { title: '展会报名' },
  },
];
```

> **重要更新**：展会报名路由现在与展会管理路由平级，不再是其子路由。
```

### 2.5 导航菜单配置

在Navigation.js中，将展会报名配置为与展会运营平级的菜单项。

```javascript
// 在Navigation.js中的menuItems配置中，添加展会报名菜单项（与展会运营平级）
const menuItems = [
  // 其他菜单项...
  
  // 展会运营菜单项（保持不变）
  {
    key: 'exhibition',
    title: '展会运营',
    icon: <ShopOutlined />,
    children: [
      { key: 'exhibition/booth', title: '展位管理' },
      { key: 'exhibition/exhibitor', title: '展商管理' },
    ],
  },
  
  // 新增展会报名菜单项（平级）
  {
    key: 'exhibition-registration',
    title: '展会报名',
    icon: <FormOutlined />,
  },
  
  // 其他菜单项...
];
```

> **重要更新**：展会报名菜单项现在与展会运营菜单项平级，不再是其子菜单。
```

## 3. 后端技术实现

### 3.1 技术栈

基于现有的项目架构，假设后端使用以下技术栈：

- Java (或其他适用的语言)
- Spring Boot (或其他适用的框架)
- MySQL (或其他适用的数据库)
- Redis (可选，用于缓存和会话管理)

### 3.2 数据库设计

#### 3.2.1 展会报名主表 (exhibition_registration)

```sql
CREATE TABLE `exhibition_registration` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `company_name` VARCHAR(255) NOT NULL COMMENT '公司名称',
  `contact_name` VARCHAR(100) NOT NULL COMMENT '联系人姓名',
  `contact_phone` VARCHAR(20) NOT NULL COMMENT '联系电话',
  `contact_email` VARCHAR(100) DEFAULT NULL COMMENT '联系邮箱',
  `company_address` VARCHAR(500) DEFAULT NULL COMMENT '公司地址',
  `company_introduction` TEXT COMMENT '公司介绍',
  `booth_requirements` TEXT COMMENT '展位需求',
  `registration_time` DATETIME NOT NULL COMMENT '报名时间',
  `status` VARCHAR(20) DEFAULT 'pending' COMMENT '状态：pending(待审核), approved(已通过), rejected(未通过)',
  `audit_time` DATETIME DEFAULT NULL COMMENT '审核时间',
  `auditor_id` BIGINT DEFAULT NULL COMMENT '审核人ID',
  `audit_opinion` TEXT COMMENT '审核意见',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  INDEX `idx_status` (`status`),
  INDEX `idx_registration_time` (`registration_time`),
  INDEX `idx_company_name` (`company_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='展会报名信息表';
```

#### 3.2.2 报名材料表 (registration_material)

```sql
CREATE TABLE `registration_material` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `registration_id` BIGINT NOT NULL COMMENT '报名记录ID',
  `file_name` VARCHAR(255) NOT NULL COMMENT '文件名称',
  `file_path` VARCHAR(500) NOT NULL COMMENT '文件路径',
  `file_size` BIGINT DEFAULT NULL COMMENT '文件大小(字节)',
  `file_type` VARCHAR(50) DEFAULT NULL COMMENT '文件类型',
  `upload_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '上传时间',
  PRIMARY KEY (`id`),
  INDEX `idx_registration_id` (`registration_id`),
  CONSTRAINT `fk_registration_material_registration` FOREIGN KEY (`registration_id`) REFERENCES `exhibition_registration` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='报名材料表';
```

#### 3.2.3 短信发送记录表 (sms_record)

```sql
CREATE TABLE `sms_record` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `registration_id` BIGINT NOT NULL COMMENT '报名记录ID',
  `phone_number` VARCHAR(20) NOT NULL COMMENT '手机号码',
  `sms_content` TEXT NOT NULL COMMENT '短信内容',
  `send_status` VARCHAR(20) DEFAULT 'sending' COMMENT '发送状态：sending(发送中), success(成功), failed(失败)',
  `send_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '发送时间',
  `error_message` TEXT COMMENT '错误信息',
  PRIMARY KEY (`id`),
  INDEX `idx_registration_id` (`registration_id`),
  INDEX `idx_send_status` (`send_status`),
  CONSTRAINT `fk_sms_record_registration` FOREIGN KEY (`registration_id`) REFERENCES `exhibition_registration` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='短信发送记录表';
```

### 3.3 API接口设计

#### 3.3.1 报名管理接口

| API路径 | 方法 | 模块/文件 | 类型 | 功能描述 | 请求参数 | 成功响应 |
|---------|------|-----------|------|----------|----------|----------|
| /api/exhibition/registration/list | GET | RegistrationController | Controller | 获取报名列表 | page, pageSize, searchText, status, startDate, endDate | `{"code":200, "data":{"list":[], "total":0}}` |
| /api/exhibition/registration/statistics | GET | RegistrationController | Controller | 获取报名统计 | startDate, endDate | `{"code":200, "data":{"total":0, "pending":0, "approved":0, "rejected":0}}` |
| /api/exhibition/registration/{id} | GET | RegistrationController | Controller | 获取报名详情 | id | `{"code":200, "data":{}}` |
| /api/exhibition/registration | POST | RegistrationController | Controller | 创建报名记录 | 报名信息JSON | `{"code":200, "data":{"id":1}}` |
| /api/exhibition/registration/{id} | PUT | RegistrationController | Controller | 更新报名记录 | id, 报名信息JSON | `{"code":200}` |
| /api/exhibition/registration/{id} | DELETE | RegistrationController | Controller | 删除报名记录 | id | `{"code":200}` |
| /api/exhibition/registration/{id}/audit | POST | RegistrationController | Controller | 审核报名记录 | id, {"status": "approved/rejected", "opinion": ""} | `{"code":200}` |
| /api/exhibition/registration/batch-audit | POST | RegistrationController | Controller | 批量审核报名记录 | {"ids": [], "status": "approved/rejected", "opinion": ""} | `{"code":200}` |
| /api/exhibition/registration/export | GET | RegistrationController | Controller | 导出报名数据 | ids, groupBy(company/contact), format(xlsx/csv) | 文件流 |
| /api/exhibition/registration/send-sms | POST | RegistrationController | Controller | 发送短信 | {"ids": [], "content": ""} | `{"code":200, "data":{"successCount":0, "failCount":0}}` |
| /api/exhibition/registration/upload | POST | RegistrationController | Controller | 上传材料 | file | `{"code":200, "data":{"fileUrl": "", "fileName": ""}}` |

#### 3.3.2 材料管理接口

| API路径 | 方法 | 模块/文件 | 类型 | 功能描述 | 请求参数 | 成功响应 |
|---------|------|-----------|------|----------|----------|----------|
| /api/exhibition/registration/{id}/materials | GET | RegistrationController | Controller | 获取报名材料列表 | id | `{"code":200, "data":[]}` |
| /api/exhibition/registration/material/{id} | DELETE | RegistrationController | Controller | 删除报名材料 | id | `{"code":200}` |

### 3.4 服务层实现

#### 3.4.1 报名服务 (RegistrationService)

主要业务逻辑处理，包括报名数据的增删改查、审核、统计等功能。

```java
// RegistrationService.java 核心方法示例
public interface RegistrationService {
    // 获取报名列表
    PageResult<RegistrationDTO> getRegistrationList(RegistrationQuery query);
    
    // 获取统计数据
    RegistrationStatistics getStatistics(DateRange dateRange);
    
    // 获取报名详情
    RegistrationDetailDTO getRegistrationDetail(Long id);
    
    // 创建报名记录
    Long createRegistration(RegistrationCreateDTO createDTO);
    
    // 更新报名记录
    void updateRegistration(Long id, RegistrationUpdateDTO updateDTO);
    
    // 删除报名记录
    void deleteRegistration(Long id);
    
    // 审核报名记录
    void auditRegistration(Long id, AuditDTO auditDTO, Long auditorId);
    
    // 批量审核报名记录
    BatchAuditResult batchAuditRegistration(List<Long> ids, AuditDTO auditDTO, Long auditorId);
    
    // 导出报名数据
    void exportRegistrationData(OutputStream out, ExportQuery query);
    
    // 发送短信
    SmsSendResult sendSms(List<Long> ids, String content);
}
```

#### 3.4.2 短信服务 (SmsService)

负责短信发送功能，对接短信服务提供商API。

```java
// SmsService.java 核心方法示例
public interface SmsService {
    // 发送单条短信
    SmsSendStatus sendSingleSms(String phoneNumber, String content);
    
    // 批量发送短信
    List<SmsSendResult> sendBatchSms(List<SmsMessageDTO> messages);
    
    // 获取短信模板
    List<SmsTemplate> getTemplates();
}
```

## 4. 技术实现注意事项

### 4.1 文件上传与存储

- 材料上传使用multipart/form-data格式
- 文件存储可以选择本地文件系统或云存储服务
- 上传文件需要进行安全校验，限制文件类型和大小
- 为上传的文件生成唯一文件名，避免覆盖

### 4.2 数据导出

- 支持Excel和CSV格式导出
- 实现按公司或人名分组的导出功能
- 处理大数据量导出时的内存问题，可考虑分页查询后合并
- 导出文件时设置适当的响应头，支持浏览器直接下载

### 4.3 短信发送

- 对接可靠的短信服务提供商
- 实现短信模板功能，提高发送效率
- 记录短信发送状态和结果，方便追踪
- 实现发送频率控制，避免频繁发送

### 4.4 性能优化

- 对报名列表查询添加适当的索引
- 实现分页加载，避免一次性加载过多数据
- 对统计数据进行缓存，减少数据库查询压力
- 使用异步处理耗时操作，如文件导出、短信发送等

## 5. 安全性考虑

### 5.1 数据安全

- 敏感信息（如联系电话、邮箱）在日志中脱敏处理
- 数据库连接使用SSL加密
- 定期数据备份，确保数据可靠性

### 5.2 接口安全

- 所有接口添加身份认证和权限校验
- 实现请求参数验证，防止恶意数据注入
- 添加接口访问频率限制，防止暴力攻击
- 使用HTTPS协议传输数据

### 5.3 文件安全

- 上传文件进行病毒扫描
- 限制上传文件的类型和大小
- 文件访问添加权限控制，防止未授权访问

## 6. 部署建议

### 6.1 环境要求

- 前端：Node.js 14+
- 后端：JDK 1.8+，Maven 3.6+
- 数据库：MySQL 5.7+
- 可选：Redis 5.0+（用于缓存）

### 6.2 部署步骤

1. **前端部署**
   - 执行 `npm install` 安装依赖
   - 执行 `npm run build` 构建生产版本
   - 将构建产物部署到Web服务器

2. **后端部署**
   - 执行 `mvn clean package` 打包应用
   - 将生成的jar包部署到服务器
   - 配置环境变量和配置文件
   - 启动应用

3. **数据库部署**
   - 执行数据库初始化脚本
   - 配置数据库连接池

## 7. 测试策略

### 7.1 单元测试

- 对核心业务逻辑进行单元测试
- 对API接口进行接口测试
- 测试覆盖率要求达到80%以上

### 7.2 集成测试

- 测试前后端交互是否正常
- 测试文件上传下载功能
- 测试数据导出功能
- 测试短信发送功能

### 7.3 性能测试

- 测试系统在大数据量下的响应时间
- 测试并发访问下的系统稳定性
- 测试文件上传下载的性能

## 8. 后续优化方向

1. **功能优化**
   - 增加报名提醒功能
   - 实现报名进度跟踪
   - 添加更多的统计分析图表

2. **性能优化**
   - 优化数据库查询效率
   - 使用缓存技术减少数据库压力
   - 实现数据分片存储，应对大数据量

3. **用户体验优化**
   - 添加批量导入报名信息功能
   - 优化报名表单的用户体验
   - 添加更详细的操作日志和审计功能