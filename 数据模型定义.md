# 大屏管理系统数据模型定义

## 文档信息

| 项目名称 | 人民城轨2.0 - 大屏管理系统 |
|---------|------------------------|
| 文档版本 | v2.0 |
| 文档类型 | 数据模型定义文档 |
| 创建日期 | 2025-10-13 |
| 适用范围 | 数据库设计与API接口 |

---

## 1. 大屏信息表（screen_info）

### 表结构

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | BIGINT | PRIMARY KEY AUTO_INCREMENT | 大屏ID |
| name | VARCHAR(100) | NOT NULL | 大屏名称 |
| maintenance_user | VARCHAR(50) | NOT NULL | 维护人 |
| maintenance_time | DATETIME | NOT NULL | 维护时间 |
| refresh_interval | INT | NOT NULL DEFAULT 30 | 刷新间隔（秒） |
| create_time | DATETIME | NOT NULL | 创建时间 |
| create_user | VARCHAR(50) | NOT NULL | 创建人 |

### 索引设计
- PRIMARY KEY (id)
- INDEX idx_name (name)
- INDEX idx_maintenance_user (maintenance_user)
- INDEX idx_create_time (create_time)

### 示例数据
```sql
INSERT INTO screen_info (name, maintenance_user, maintenance_time, refresh_interval, create_time, create_user) VALUES
('人民城轨数据大屏-日常版', '张三', '2025-10-13 14:30:00', 30, '2025-09-01 10:00:00', '系统管理员'),
('协会概况', '李四', '2025-10-13 15:20:00', 30, '2025-09-05 09:30:00', '王五'),
('标准部', '赵六', '2025-10-12 16:45:00', 30, '2025-09-10 11:15:00', '陈七');
```

---

## 2. 模块数据表（module_data）

### 表结构

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | BIGINT | PRIMARY KEY AUTO_INCREMENT | 记录ID |
| screen_id | BIGINT | NOT NULL, FOREIGN KEY | 所属大屏ID |
| module_type | VARCHAR(50) | NOT NULL | 模块类型 |
| module_key | VARCHAR(50) | NOT NULL | 模块标识 |
| data | JSON | NOT NULL | 模块数据 |
| update_time | DATETIME | NOT NULL | 更新时间 |
| update_user | VARCHAR(50) | NOT NULL | 更新人 |
| import_batch_id | VARCHAR(100) | NULL | Excel导入批次ID |
| import_time | DATETIME | NULL | Excel导入时间 |

### 索引设计
- PRIMARY KEY (id)
- FOREIGN KEY (screen_id) REFERENCES screen_info(id)
- INDEX idx_screen_module (screen_id, module_key)
- INDEX idx_module_type (module_type)
- INDEX idx_update_time (update_time)
- INDEX idx_import_batch (import_batch_id)

### 数据示例

#### 新闻类模块数据结构
```json
{
  "title": "北京地铁八角游乐园站将封站到27年",
  "date": "2025-05-28",
  "image": "https://via.placeholder.com/133x89",
  "content": "详细内容...",
  "sort": 1
}
```

#### 列表类模块数据结构
```json
{
  "title": "城轨业主领导人峰会",
  "month": "6月",
  "location": "北京",
  "description": "活动描述..."
}
```

#### 配置类模块数据结构
```json
{
  "todayNumbers": "3, 8",
  "tomorrowNumbers": "4, 9",
  "timeRange": "07:00-20:00",
  "weekSchedule": ["1/6", "2/7", "3/8", "4/9", "5/0", "不限", "不限"]
}
```

#### 数据类模块数据结构
```json
{
  "total": 1129,
  "categories": [
    {"name": "副会长会员名录", "value": 28},
    {"name": "常务理事会员名录", "value": 92},
    {"name": "理事会员名录", "value": 384},
    {"name": "普通会员名录", "value": 625},
    {"name": "申请入会单位", "value": 18}
  ]
}
```

---

## 3. 模块类型定义

### 3.1 日常版界面模块
| 模块标识 | 模块名称 | 数据类型 | 更新频率 |
|---------|---------|---------|---------|
| weather | 天气信息 | 配置类 | 低 |
| traffic | 限行尾号 | 配置类 | 高 |
| news | 行业新闻 | 新闻类 | 高 |
| partyNews | 党建园地 | 新闻类 | 中 |
| workPlan | 工作规划 | 列表类 | 中 |
| memberStats | 会员单位概况 | 数据类 | 中 |
| industryStats | 行业统计 | 数据类 | 中 |
| brandActivity | 品牌活动 | 配置类 | 低 |
| live | 活动直播 | 配置类 | 高 |

### 3.2 协会版界面模块
| 模块标识 | 模块名称 | 数据类型 | 更新频率 |
|---------|---------|---------|---------|
| associationInfo | 协会基本信息 | 配置类 | 低 |
| organization | 组织结构 | 配置类 | 低 |
| development | 发展历程 | 配置类 | 低 |
| achievements | 主要成就 | 配置类 | 低 |
| services | 服务内容 | 配置类 | 低 |
| contact | 联系方式 | 配置类 | 低 |
| memberStats | 会员统计 | 数据类 | 中 |
| news | 最新动态 | 新闻类 | 高 |

### 3.3 标准版界面模块
| 模块标识 | 模块名称 | 数据类型 | 更新频率 |
|---------|---------|---------|---------|
| standardStats | 标准制定统计 | 数据类 | 中 |
| technicalSpecs | 技术规范 | 配置类 | 中 |
| qualityCert | 质量认证 | 数据类 | 中 |
| standardRelease | 标准发布 | 配置类 | 高 |
| workflow | 工作流程 | 配置类 | 低 |
| latestStandards | 最新标准 | 配置类 | 高 |
| applicationCases | 标准应用案例 | 配置类 | 中 |

### 3.4 行业版界面模块
| 模块标识 | 模块名称 | 数据类型 | 更新频率 |
|---------|---------|---------|---------|
| cityDistribution | 城市分布统计 | 数据类 | 中 |
| operationMileage | 运营里程统计 | 数据类 | 中 |
| passengerVolume | 客运量统计 | 数据类 | 高 |
| vehicleTypes | 车辆制式分布 | 数据类 | 低 |
| headwayStats | 发车间隔统计 | 数据类 | 低 |
| automatedLines | 全自动运行线路 | 数据类 | 中 |
| cityGroupDistribution | 城市群分布 | 数据类 | 低 |
| systemRatio | 制式占比分布 | 数据类 | 低 |

### 3.5 评审版界面模块
| 模块标识 | 模块名称 | 数据类型 | 更新频率 |
|---------|---------|---------|---------|
| reviewIntro | 职称评审介绍 | 配置类 | 低 |
| applicationStats | 申报情况统计 | 数据类 | 高 |
| passStats | 评审通过情况 | 数据类 | 高 |
| applicantUnits | 申报人员单位属性 | 数据类 | 中 |
| passUnits | 通过人员单位属性 | 数据类 | 中 |
| professionalRatio | 专业占比统计 | 数据类 | 中 |
| regionalDistribution | 地域分布统计 | 数据类 | 中 |
| levelStats | 各级别人数统计 | 数据类 | 中 |

---

## 4. API接口设计

### 4.1 大屏管理接口

#### 获取大屏列表
```
GET /api/screens
```

#### 获取大屏详情
```
GET /api/screens/{id}
```

#### 创建大屏
```
POST /api/screens
```

#### 更新大屏配置
```
PUT /api/screens/{id}
```

#### 删除大屏
```
DELETE /api/screens/{id}
```

### 4.2 模块数据接口

#### 获取模块数据
```
GET /api/screens/{screenId}/modules/{moduleKey}
```

#### 更新模块数据
```
PUT /api/screens/{screenId}/modules/{moduleKey}
```

#### 批量更新模块数据
```
POST /api/screens/{screenId}/modules/batch
```

#### Excel数据导入
```
POST /api/screens/{screenId}/modules/import
```

#### Excel模板导出
```
GET /api/screens/{screenId}/modules/export-template
```

---

## 5. 数据同步机制

### 5.1 同步策略
- **定时同步**: 按照大屏设置的刷新间隔自动同步
- **手动同步**: 运营人员主动触发数据同步
- **增量同步**: 只同步变更的数据，减少网络传输

### 5.2 同步流程
1. 检查数据源连接状态
2. 获取数据源最新数据
3. 验证数据格式和完整性
4. 更新模块数据表
5. 记录同步日志
6. 通知前端刷新显示

### 5.3 同步状态监控
- 同步成功/失败状态
- 同步耗时统计
- 数据变更量统计
- 错误日志记录

---

## 6. 安全与权限

### 6.1 数据安全
- 敏感数据字段加密存储
- API接口访问日志记录
- 数据传输使用HTTPS加密

### 6.2 操作权限
- 基于角色的访问控制
- 操作日志审计
- 敏感操作二次确认

---

## 7. 性能优化

### 7.1 数据库优化
- 合理索引设计
- 读写分离部署
- 缓存热点数据

### 7.2 接口优化
- 分页查询大结果集
- 压缩数据传输
- 异步处理批量操作

### 7.3 前端优化
- 数据懒加载
- 虚拟滚动长列表
- 本地缓存静态数据
