# 三网合一功能设计方案补充文档

## 1. 文档信息
- **文档版本**：V1.0
- **创建日期**：2024-03-15
- **文档状态**：补充文档
- **作者**：产品技术负责人

## 2. 角色与权限设计

### 2.1 角色定义

| 角色名称 | 角色描述 | 权限级别 |
| :--- | :--- | :--- |
| 超级管理员 | 系统最高权限，可进行所有操作 | 100 |
| 内容管理员 | 负责三网合一内容的创建、编辑和发布 | 80 |
| 模板管理员 | 负责模板的创建、编辑和管理 | 70 |
| 普通编辑者 | 只能编辑内容，但需要审核才能发布 | 50 |
| 审核人员 | 负责审核和发布内容 | 60 |
| 只读用户 | 只能查看内容和发布状态 | 30 |

### 2.2 权限矩阵

| 功能 | 超级管理员 | 内容管理员 | 模板管理员 | 普通编辑者 | 审核人员 | 只读用户 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 平台选择 | ✓ | ✓ | ✗ | ✓ | ✓ | ✗ |
| 平台配置 | ✓ | ✓ | ✗ | ✓ | ✓ | ✗ |
| 创建/编辑模板 | ✓ | ✗ | ✓ | ✗ | ✗ | ✗ |
| 删除模板 | ✓ | ✗ | ✓ | ✗ | ✗ | ✗ |
| 预览模板 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 创建/编辑内容 | ✓ | ✓ | ✗ | ✓ | ✓ | ✗ |
| 提交内容审核 | ✓ | ✓ | ✗ | ✓ | ✗ | ✗ |
| 审核内容 | ✓ | ✓ | ✗ | ✗ | ✓ | ✗ |
| 发布内容 | ✓ | ✓ | ✗ | ✗ | ✓ | ✗ |
| 批量发布 | ✓ | ✓ | ✗ | ✗ | ✓ | ✗ |
| 查看发布记录 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 修改系统设置 | ✓ | ✗ | ✗ | ✗ | ✗ | ✗ |
| 管理用户权限 | ✓ | ✗ | ✗ | ✗ | ✗ | ✗ |

### 2.3 权限控制实现
- 使用RBAC（基于角色的访问控制）模型
- 前端通过权限指令控制组件显示/隐藏
- 后端API通过中间件进行权限验证
- 所有操作均记录操作日志，包含操作人、操作内容、操作时间等

## 3. API接口设计

### 3.1 平台配置相关接口

#### 3.1.1 获取平台列表
- **接口URL**：`/api/platforms/list`
- **请求方式**：GET
- **参数**：无
- **返回格式**：
  ```json
  {
    "code": 200,
    "data": [
      {
        "id": "app",
        "name": "APP",
        "available": true,
        "icon": "mobile-alt"
      },
      {
        "id": "website",
        "name": "官网",
        "available": true,
        "icon": "globe"
      },
      {
        "id": "wechat",
        "name": "微信公众号",
        "available": true,
        "icon": "weixin"
      }
    ]
  }
  ```

#### 3.1.2 获取平台栏目列表
- **接口URL**：`/api/platforms/columns`
- **请求方式**：GET
- **参数**：`platformId`（String，平台ID：app/website/wechat）
- **返回格式**：
  ```json
  {
    "code": 200,
    "data": [
      {
        "id": "1001",
        "name": "首页",
        "parentId": null
      },
      {
        "id": "1002",
        "name": "新闻资讯",
        "parentId": null
      }
    ]
  }
  ```

### 3.2 模板管理相关接口

#### 3.2.1 获取模板列表
- **接口URL**：`/api/templates`
- **请求方式**：GET
- **参数**：
  - `type`（String，可选，模板类型：general/app/website/wechat）
  - `page`（Number，可选，页码）
  - `size`（Number，可选，每页数量）
- **返回格式**：
  ```json
  {
    "code": 200,
    "data": {
      "total": 10,
      "list": [
        {
          "id": "tpl_001",
          "name": "通用新闻模板",
          "type": "general",
          "createdAt": "2024-01-01T10:00:00Z",
          "createdBy": "admin"
        }
      ],
      "page": 1,
      "size": 10
    }
  }
  ```

#### 3.2.2 创建/更新模板
- **接口URL**：`/api/templates`
- **请求方式**：POST/PUT
- **参数**：
  ```json
  {
    "id": "tpl_001", // PUT时必填
    "name": "模板名称",
    "type": "general",
    "content": "<div>{{title}}</div>",
    "variables": [
      {
        "name": "title",
        "description": "标题",
        "type": "string"
      }
    ]
  }
  ```
- **返回格式**：
  ```json
  {
    "code": 200,
    "data": {
      "id": "tpl_001",
      "name": "模板名称",
      "type": "general",
      "createdAt": "2024-01-01T10:00:00Z",
      "updatedAt": "2024-01-01T10:00:00Z",
      "createdBy": "admin"
    }
  }
  ```

#### 3.2.3 删除模板
- **接口URL**：`/api/templates/{templateId}`
- **请求方式**：DELETE
- **返回格式**：
  ```json
  {
    "code": 200,
    "message": "删除成功"
  }
  ```

### 3.3 内容发布相关接口

#### 3.3.1 发布内容
- **接口URL**：`/api/content/publish`
- **请求方式**：POST
- **参数**：
  ```json
  {
    "contentId": "content_001",
    "platformConfig": {
      "app": {
        "enabled": true,
        "columnId": "1001",
        "tags": ["热点", "新闻"]
      },
      "website": {
        "enabled": true,
        "columnId": "1002",
        "tags": ["公告"]
      },
      "wechat": {
        "enabled": false
      }
    },
    "templateId": "tpl_001"
  }
  ```
- **返回格式**：
  ```json
  {
    "code": 200,
    "data": {
      "publishId": "pub_001",
      "status": "processing"
    }
  }
  ```

#### 3.3.2 批量发布内容
- **接口URL**：`/api/content/batch-publish`
- **请求方式**：POST
- **参数**：
  ```json
  {
    "publishItems": [
      {
        "contentId": "content_001",
        "platformConfig": {...}, // 平台配置
        "templateId": "tpl_001"
      },
      {
        "contentId": "content_002",
        "platformConfig": {...}, // 平台配置
        "templateId": "tpl_002"
      }
    ]
  }
  ```
- **返回格式**：
  ```json
  {
    "code": 200,
    "data": {
      "batchId": "batch_001",
      "status": "processing"
    }
  }
  ```

#### 3.3.3 获取发布状态
- **接口URL**：`/api/content/publish-status/{publishId}`
- **请求方式**：GET
- **返回格式**：
  ```json
  {
    "code": 200,
    "data": {
      "status": "published",
      "progress": 100,
      "platforms": [
        {
          "platform": "app",
          "status": "published",
          "publishTime": "2024-01-01T10:05:00Z",
          "message": "发布成功"
        },
        {
          "platform": "website",
          "status": "published",
          "publishTime": "2024-01-01T10:06:00Z",
          "message": "发布成功"
        }
      ]
    }
  }
  ```

## 4. 数据字典和枚举定义

### 4.1 平台类型枚举

| 枚举值 | 描述 | 英文名称 |
| :--- | :--- | :--- |
| app | APP平台 | Mobile Application |
| website | 官网平台 | Official Website |
| wechat | 微信公众号平台 | WeChat Official Account |

### 4.2 发布状态枚举

| 枚举值 | 描述 | 英文名称 |
| :--- | :--- | :--- |
| draft | 草稿 | Draft |
| pending | 待发布/待审核 | Pending |
| processing | 发布中 | Processing |
| published | 已发布 | Published |
| failed | 发布失败 | Failed |
| reviewed | 已审核 | Reviewed |
| rejected | 审核驳回 | Rejected |

### 4.3 模板类型枚举

| 枚举值 | 描述 | 英文名称 |
| :--- | :--- | :--- |
| general | 通用模板 | General Template |
| app | APP专用模板 | APP Template |
| website | 官网专用模板 | Website Template |
| wechat | 微信公众号专用模板 | WeChat Template |

### 4.4 错误码定义

| 错误码 | 描述 | HTTP状态码 |
| :--- | :--- | :--- |
| 200 | 成功 | 200 |
| 400 | 请求参数错误 | 400 |
| 401 | 未授权 | 401 |
| 403 | 权限不足 | 403 |
| 404 | 资源不存在 | 404 |
| 500 | 服务器内部错误 | 500 |
| 5001 | 平台连接失败 | 500 |
| 5002 | 模板解析错误 | 500 |
| 5003 | 发布内容失败 | 500 |
| 6001 | 内容未审核 | 400 |
| 6002 | 内容已过期 | 400 |

## 5. Demo功能范围说明

### 5.1 核心演示功能（必须实现）
1. **平台选择功能**：实现三网平台的选择界面和交互
2. **基础配置功能**：APP和官网的简单配置（可模拟数据）
3. **模板列表展示**：展示预设的几个模板（无需实现模板编辑）
4. **内容发布流程演示**：实现完整的发布流程，包括确认、处理、结果展示
5. **发布结果展示**：展示模拟的发布结果和状态

### 5.2 可简化功能（Demo可简化实现）
1. **微信公众号配置**：可简化或使用默认配置
2. **批量发布功能**：可只保留界面，模拟处理过程
3. **权限控制**：可使用固定角色，无需实现完整权限控制
4. **异常处理**：只处理基本异常，无需完整的错误恢复机制
5. **性能优化**：Demo版本可适当降低性能优化要求

### 5.3 暂不实现功能（Demo可完全省略）
1. **模板创建/编辑/删除**：可使用预设模板
2. **内容版本管理**：可暂不实现
3. **完整的统计分析**：可省略或使用静态数据
4. **复杂的内容审核流程**：可使用简单审核或跳过审核
5. **多语言支持**：可只支持中文版本

### 5.4 数据模拟建议
- 使用Mock数据模拟API响应
- 预设3-5个模板供演示
- 模拟不同平台的发布延迟和结果
- 提供10条左右的历史发布记录示例

## 6. 数据流向图

### 6.1 内容发布数据流向
```
用户界面 → 前端处理层 → API网关 → 内容处理服务 → 平台适配器 → 各平台API
     ←                ←          ←                  ←
```

### 6.2 详细数据交互流程
1. **用户操作**：用户在界面上编辑内容，选择平台和配置
2. **前端处理**：
   - 表单验证
   - 数据格式化
   - 调用发布API
3. **API处理**：
   - 权限验证
   - 数据处理
   - 调用内容发布服务
4. **内容适配**：
   - 根据模板进行内容转换
   - 针对不同平台进行适配处理
5. **平台发布**：
   - 调用各平台的发布接口
   - 处理平台特定逻辑
6. **状态更新**：
   - 更新发布状态
   - 存储发布记录
7. **结果反馈**：
   - 返回发布结果给前端
   - 前端展示给用户

## 7. 响应式设计方案

### 7.1 断点设计（与UI设计规范保持一致）

| 断点名称 | 设备类型 | 宽度范围 | 适配策略 |
| :--- | :--- | :--- | :--- |
| 移动端 | 手机 | < 768px | 单列布局，隐藏次要功能 |
| 平板 | 平板设备 | 768px - 991px | 简化布局，可折叠侧边栏 |
| 小屏幕 | 小型桌面 | 992px - 1199px | 双列布局，简化部分组件 |
| 中屏幕 | 标准桌面 | 1200px - 1799px | 三列布局，完整功能展示 |
| 大屏幕 | 大型桌面 | ≥ 1800px | 多列布局，增强数据展示 |

### 7.2 组件适配策略

| 组件类型 | 移动端 | 平板 | 小屏幕 | 中屏幕 | 大屏幕 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 导航栏 | 汉堡菜单 | 侧边折叠 | 标准侧边栏 | 标准侧边栏 | 宽侧边栏 |
| 平台选择 | 底部展开 | 侧边展开 | 固定在右侧 | 固定在右侧 | 固定在右侧 |
| 配置表单 | 单列垂直 | 单列垂直 | 双列 | 三列 | 四列 |
| 表格展示 | 卡片式 | 简化表格 | 标准表格 | 完整表格 | 增强表格 |
| 操作按钮 | 底部浮动 | 底部浮动 | 行内按钮 | 行内按钮 | 行内按钮 |

### 7.3 核心页面响应式设计

#### 7.3.1 内容发布页面
- 移动端：编辑器和平台选择垂直排列，平台配置通过折叠面板展示
- 平板：编辑器在上，平台选择和配置在下，可通过切换标签查看
- 桌面端：左侧编辑器，右侧平台选择和配置面板

#### 7.3.2 模板管理页面
- 移动端：卡片式模板列表，操作通过长按菜单实现
- 平板：简化表格，隐藏部分列
- 桌面端：完整表格展示，支持列排序和筛选

#### 7.3.3 发布结果页面
- 移动端：卡片式列表展示，每条记录可展开查看详情
- 平板：简化表格，提供基础筛选
- 桌面端：完整表格，支持复杂查询和导出功能