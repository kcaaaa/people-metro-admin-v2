# 三网合一功能详细设计文档

## 1. 文档信息
- **文档版本**：V1.1
- **创建日期**：2025-11-07
- **更新日期**：2024-03-15
- **文档状态**：完善版
- **作者**：产品技术负责人
- **更新说明**：补充了角色与权限设计、API接口设计、数据字典、Demo功能范围、响应式设计方案等内容

## 2. 功能概述
三网合一功能旨在实现官网、APP和微信公众号三个平台的内容统一编辑和发布，通过一次编辑、多平台发布的方式，提高内容发布效率，保证内容一致性，降低编辑人员工作负担。

## 3. 功能详细设计

### 3.1 平台选择模块

#### 3.1.1 功能描述
在内容发布界面中，提供三个平台（官网、APP、微信公众号）的选择功能，用户可以通过勾选的方式选择要发布的平台。

#### 3.1.2 功能结构
- 平台选择区域
  - 官网复选框
  - APP复选框
  - 微信公众号复选框
  - 全选/取消全选按钮

#### 3.1.3 交互逻辑
- 勾选平台后，显示相应平台的配置区域
- 取消勾选平台后，隐藏相应平台的配置区域
- 全选按钮可以一键勾选所有平台
- 取消全选按钮可以一键取消所有平台的勾选

#### 3.1.4 技术实现要点
- 使用Element UI的Checkbox组件实现平台选择
- 通过Vue的数据绑定实现勾选状态与配置区域显示的联动
- 保存用户的平台选择状态到表单数据中

### 3.2 平台配置模块

#### 3.2.1 功能描述
根据用户选择的发布平台，提供相应的配置选项，包括栏目选择、封面样式、显示顺序等。

#### 3.2.2 功能结构
- APP配置区域
  - APP栏目选择下拉框
  - APP专属标签设置
- 官网配置区域
  - 官网栏目选择下拉框
  - 官网专属标签设置
- 公众号配置区域
  - 封面样式选择（大图、多图、无图）
  - 显示顺序设置
  - 公众号专属标签设置

#### 3.2.3 交互逻辑
- 选择平台后自动显示相应的配置区域
- 配置项变更会实时更新表单数据
- 表单验证确保必填项已填写

#### 3.2.4 技术实现要点
- 使用Element UI的Select、Radio等组件实现配置项
- 从现有栏目管理系统获取可用栏目列表
- 实现表单验证和错误提示

### 3.3 模板管理模块

#### 3.3.1 功能描述
提供模板的创建、编辑、删除、预览功能，支持管理员管理系统中的内容模板。

#### 3.3.2 功能结构
- 模板列表
  - 模板名称
  - 模板类型（通用、APP专用、官网专用、公众号专用）
  - 创建时间
  - 操作按钮（编辑、删除、预览）
- 模板创建/编辑表单
  - 模板名称
  - 模板类型
  - 模板内容（HTML结构）
  - 变量定义
- 模板预览功能
  - 实时预览模板效果
  - 支持不同设备尺寸的预览

#### 3.3.3 交互逻辑
- 点击编辑按钮进入模板编辑界面
- 点击删除按钮弹出确认对话框，确认后删除模板
- 点击预览按钮显示模板预览界面
- 创建/编辑模板时，支持实时预览效果

#### 3.3.4 技术实现要点
- 使用Element UI的Table、Form等组件构建界面
- 实现模板内容的富文本编辑
- 构建模板预览组件，支持响应式预览
- 设计模板变量系统，支持内容动态替换

### 3.4 内容发布模块

#### 3.4.1 功能描述
根据用户的平台选择和配置，将内容发布到对应的平台。

#### 3.4.2 功能结构
- 发布配置检查
- 内容适配处理
- 多平台发布处理
- 发布结果反馈

#### 3.4.3 交互逻辑
- 用户确认发布后，系统进行发布前检查
- 对各平台内容进行适配处理（根据模板和平台特性）
- 调用相应平台的发布接口
- 显示发布进度和结果
- 发布成功后更新内容状态和发布信息

#### 3.4.4 技术实现要点
- 实现发布前的数据验证
- 构建内容适配引擎，根据平台特性转换内容
- 实现异步发布处理，避免长时间等待
- 设计发布结果反馈机制

### 3.5 批量发布模块

#### 3.5.1 功能描述
支持选择多篇内容进行批量发布，针对每篇内容可以单独设置发布平台和配置。

#### 3.5.2 功能结构
- 内容选择区域
- 批量操作工具栏
- 批量发布配置界面
- 发布进度和结果显示

#### 3.5.3 交互逻辑
- 用户在内容列表中选择多篇内容
- 点击批量发布按钮
- 进入批量发布配置界面，可为每篇内容单独设置平台和配置
- 确认发布后，系统逐个处理内容发布
- 显示每篇内容的发布进度和结果

#### 3.5.4 技术实现要点
- 实现内容选择和批量操作功能
- 设计批量发布配置界面，支持单篇内容的配置
- 实现批量发布的异步处理
- 构建发布进度跟踪和结果反馈机制

## 4. 数据结构设计

### 4.1 发布配置数据结构
```javascript
{
  platformConfig: {
    // 是否发布到APP
    app: {
      enabled: boolean,
      columnId: string, // APP栏目ID
      tags: Array<string> // APP标签
    },
    // 是否发布到官网
    website: {
      enabled: boolean,
      columnId: string, // 官网栏目ID
      tags: Array<string> // 官网标签
    },
    // 是否发布到公众号
    wechat: {
      enabled: boolean,
      coverType: string, // 封面类型: 'single', 'multiple', 'none'
      displayOrder: number, // 显示顺序
      tags: Array<string> // 公众号标签
    }
  },
  templateId: string // 选择的模板ID
}
```

### 4.2 模板数据结构
```javascript
{
  id: string,
  name: string,
  type: string, // 'general', 'app', 'website', 'wechat'
  content: string, // HTML模板内容
  variables: Array<{
    name: string,
    description: string,
    type: string
  }>,
  createdAt: Date,
  updatedAt: Date,
  createdBy: string
}
```

### 4.3 内容数据结构扩展
```javascript
{
  // 现有内容字段...
  publishInfo: {
    platforms: [
      {
        platform: string, // 'app', 'website', 'wechat'
        status: string, // 'pending', 'published', 'failed'
        publishTime: Date,
        config: Object // 该平台的发布配置
      }
    ],
    templateId: string
  }
}
```

## 5. 业务流程图

### 5.1 内容发布流程
```
开始 → 进入内容发布页面 → 编辑内容 → 选择发布平台 → 配置平台参数 → 选择模板 → 提交发布请求 → 系统检查配置 → 内容适配处理 → 调用平台发布接口 → 更新发布状态 → 返回发布结果 → 结束
```

### 5.2 模板管理流程
```
开始 → 进入模板管理页面 → 选择操作(创建/编辑/删除/预览) → 执行相应操作 → 保存/更新模板 → 结束
```

### 5.3 批量发布流程
```
开始 → 进入内容列表页面 → 选择多篇内容 → 点击批量发布 → 配置每篇内容的发布平台和参数 → 提交发布请求 → 系统逐个处理发布 → 更新发布状态 → 返回发布结果 → 结束
```

## 6. 界面原型设计

### 6.1 内容发布界面
- 顶部：页面标题、返回按钮
- 左侧：内容编辑区域
- 右侧：平台选择和配置区域
  - 平台选择（复选框组）
  - 平台配置（根据选择动态显示）
  - 模板选择下拉框
- 底部：操作按钮（预览、保存草稿、发布）

### 6.2 模板管理界面
- 顶部：页面标题、新增模板按钮
- 中部：模板列表（表格形式）
  - 列：模板名称、类型、创建时间、操作
  - 操作：编辑、删除、预览
- 模板编辑弹窗
  - 模板基本信息表单
  - 模板内容编辑器
  - 变量定义区域
  - 预览区域

### 6.3 批量发布配置界面
- 顶部：页面标题、已选择内容数量
- 中部：内容列表及配置
  - 每篇内容显示标题和发布平台选择
  - 可展开查看详细配置
- 底部：操作按钮（确认发布、取消）

## 7. 异常处理机制

### 7.1 发布异常处理
- 平台发布失败时，记录失败原因
- 提供重试机制
- 部分平台发布失败时，不影响其他平台的发布结果

### 7.2 模板异常处理
- 模板解析失败时的错误提示
- 模板变量缺失时的处理机制
- 模板内容验证和错误提示

### 7.3 系统异常处理
- 网络异常时的状态保存和恢复
- 权限不足时的错误提示
- 操作超时的处理机制

## 8. 性能优化考虑

### 8.1 前端优化
- 组件懒加载
- 图片压缩和懒加载
- 减少不必要的数据请求
- 使用虚拟滚动处理大数据列表

### 8.2 后端优化
- 异步处理内容发布
- 批量操作优化
- 缓存常用数据
- 数据库索引优化

## 9. 安全考虑

### 9.1 权限控制
- 严格的角色权限管理
- 操作日志记录
- 敏感操作二次验证

### 9.2 数据安全
- 数据传输加密
- 敏感信息脱敏
- 防止SQL注入和XSS攻击

### 9.3 接口安全
- API接口权限验证
- 请求频率限制
- 防止跨站请求伪造(CSRF)

## 10. 角色与权限设计

### 10.1 角色定义
- **超级管理员**：拥有所有功能权限，可管理所有用户和配置
- **内容管理员**：负责内容发布和管理
- **模板管理员**：负责模板的创建、编辑和管理
- **平台管理员**：负责平台配置和管理
- **审核员**：负责内容审核和发布审批
- **普通用户**：仅能查看已发布内容

### 10.2 权限矩阵
| 功能模块 | 超级管理员 | 内容管理员 | 模板管理员 | 平台管理员 | 审核员 | 普通用户 |
|---------|-----------|-----------|-----------|-----------|-------|----------|
| 平台选择 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 平台配置 | ✓ | × | × | ✓ | × | × |
| 模板创建 | ✓ | ✓ | ✓ | × | × | × |
| 模板编辑 | ✓ | ✓ | ✓ | × | × | × |
| 模板删除 | ✓ | × | ✓ | × | × | × |
| 内容发布 | ✓ | ✓ | × | × | × | × |
| 批量发布 | ✓ | ✓ | × | × | × | × |
| 内容审核 | ✓ | × | × | × | ✓ | × |
| 数据统计 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |

### 10.3 权限控制实现
- **基于RBAC模型**：实现基于角色的访问控制
- **前端权限校验**：按钮、菜单等元素的显示控制
- **后端权限校验**：API接口的权限验证

## 11. API接口设计

### 11.1 平台配置相关接口
- **获取平台列表**
  - URL: `/api/platforms`
  - Method: GET
  - 返回格式: `{"code": 200, "data": [{"id": 1, "name": "APP", "key": "app", "status": 1}], "message": "success"}`

- **更新平台配置**
  - URL: `/api/platforms/:id/config`
  - Method: PUT
  - 参数: `{"columns": [...], "tags": [...], "coverStyle": {...}}`
  - 返回格式: `{"code": 200, "data": true, "message": "更新成功"}`

### 11.2 模板管理相关接口
- **获取模板列表**
  - URL: `/api/templates`
  - Method: GET
  - 参数: `{"page": 1, "pageSize": 20, "type": "content"}`
  - 返回格式: `{"code": 200, "data": {"list": [...], "total": 100}, "message": "success"}`

- **创建/更新模板**
  - URL: `/api/templates`
  - Method: POST/PUT
  - 参数: `{"name": "...", "type": "content", "htmlContent": "...", "variables": [...]}`
  - 返回格式: `{"code": 200, "data": {"id": 1, ...}, "message": "操作成功"}`

- **删除模板**
  - URL: `/api/templates/:id`
  - Method: DELETE
  - 返回格式: `{"code": 200, "data": true, "message": "删除成功"}`

### 11.3 内容发布相关接口
- **发布内容**
  - URL: `/api/content/publish`
  - Method: POST
  - 参数: `{"templateId": 1, "platforms": ["app", "web", "miniapp"], "content": {...}}`
  - 返回格式: `{"code": 200, "data": {"publishId": "...", "status": "pending"}, "message": "发布成功"}`

- **批量发布**
  - URL: `/api/content/batch-publish`
  - Method: POST
  - 参数: `{"publishConfigs": [...]}`
  - 返回格式: `{"code": 200, "data": {"batchId": "...", "total": 10, "success": 8}, "message": "批量发布成功"}`

- **发布状态查询**
  - URL: `/api/content/publish/:id/status`
  - Method: GET
  - 返回格式: `{"code": 200, "data": {"status": "published", "details": {...}}, "message": "success"}`

## 12. 数据字典和枚举定义

### 12.1 平台类型
| 枚举值 | 描述 | 说明 |
|-------|------|------|
| app | APP | 移动端应用 |
| web | Web | Web端应用 |
| miniapp | 小程序 | 微信小程序 |

### 12.2 发布状态
| 枚举值 | 描述 | 说明 |
|-------|------|------|
| pending | 待审核 | 等待审核员审核 |
| approved | 已审核 | 审核通过 |
| published | 已发布 | 已发布到各平台 |
| failed | 发布失败 | 发布过程中出现错误 |
| revoked | 已撤回 | 已撤回发布 |

### 12.3 模板类型
| 枚举值 | 描述 | 说明 |
|-------|------|------|
| content | 内容模板 | 用于内容发布 |
| banner | Banner模板 | 用于Banner展示 |
| notification | 通知模板 | 用于消息通知 |

### 12.4 错误码定义
| 错误码 | 描述 |
|-------|------|
| 40001 | 参数错误 |
| 40002 | 权限不足 |
| 40003 | 资源不存在 |
| 40004 | 平台配置错误 |
| 50001 | 服务器内部错误 |
| 50002 | 发布失败 |
| 50003 | 模板解析失败 |

## 13. Demo功能范围说明

### 13.1 核心演示功能
- 平台选择功能：完整实现三端选择和配置
- 模板管理：基础的CRUD操作和预览功能
- 内容发布：单条内容的发布流程和状态展示
- 批量发布：基础的批量发布功能，简化版配置

### 13.2 可简化功能
- 权限控制：演示版可简化为基本的角色切换
- 审核流程：可简化为直接发布，跳过审核
- 数据统计：提供基础统计展示
- 异常处理：提供简化的错误提示

### 13.3 暂不实现功能
- 复杂的内容审核流程
- 完整的日志记录系统
- 高级数据分析
- 定时发布功能

## 14. 响应式设计方案

### 14.1 响应式断点设计
- **超大屏幕**：≥ 1600px
- **大屏幕**：1400-1599px
- **中屏幕**：1200-1399px
- **小屏幕**：992-1199px
- **平板**：768-991px
- **移动端**：< 768px

### 14.2 组件适配策略
- **布局组件**：使用Element UI的栅格系统自动适配
- **表格组件**：小屏幕下自动切换为列表模式
- **表单组件**：根据屏幕宽度调整布局
- **导航组件**：移动端自动切换为抽屉式导航

## 15. 部署与测试建议

### 15.1 部署建议
- 分阶段部署，先在测试环境验证
- 灰度发布，逐步扩大用户范围
- 准备回滚方案

### 15.2 测试建议
- 单元测试覆盖核心功能
- 集成测试验证模块间交互
- 性能测试验证系统负载能力
- 用户体验测试验证功能易用性