# 人民城轨2.0 项目部署问题记录

## 1. 部署环境要求

| 环境项 | 版本/要求 | 说明 |
|-------|----------|------|
| 操作系统 | Windows Server 2016 或更高版本 | 建议使用Windows Server 2019 |
| IIS | 8.5 或更高版本 | Web服务器 |
| Node.js | 16.13.0 或更高版本 | 构建环境 |
| Git | 2.20.0 或更高版本 | 版本控制 |
| .NET Framework | 4.7.2 或更高版本 | 运行环境 |

## 2. 常见部署问题及解决方案

### 2.1 问题：Git克隆失败

#### 2.1.1 问题描述
```
Cloning into '.'...
fatal: unable to access 'https://github.com/your-organization/people-metro-admin-v2.git/': SSL certificate problem: self signed certificate in certificate chain
```

#### 2.1.2 解决方案
1. 检查网络连接是否正常
2. 检查Git仓库地址是否正确
3. 如果是自签名证书问题，可以使用以下命令忽略证书检查：
   ```bash
   git config --global http.sslVerify false
   ```
4. 确保有仓库的访问权限

### 2.2 问题：依赖安装失败

#### 2.2.1 问题描述
```
npm ERR! code ECONNRESET
npm ERR! network socket hang up
```

#### 2.2.2 解决方案
1. 检查网络连接是否稳定
2. 更换npm源为国内镜像：
   ```bash
   npm config set registry https://registry.npmmirror.com
   ```
3. 清除npm缓存后重新安装：
   ```bash
   npm cache clean --force
   npm install
   ```
4. 确保Node.js版本符合要求（建议使用16.13.0或更高版本）

### 2.3 问题：项目构建失败

#### 2.3.1 问题描述
```
ERROR in ./src/main.js
Module not found: Error: Can't resolve 'vue' in 'D:\deploy\people-metro-admin-v2\src'
```

#### 2.3.2 解决方案
1. 确保依赖已正确安装：
   ```bash
   npm install
   ```
2. 检查package.json文件中的依赖版本是否正确
3. 如果是Vue相关错误，检查Vue的安装和配置
4. 查看详细的错误日志，定位具体问题

### 2.4 问题：IIS站点无法访问

#### 2.4.1 问题描述
部署完成后，访问站点显示404错误或空白页面。

#### 2.4.2 解决方案
1. 检查IIS站点是否已正确配置，包括物理路径、绑定端口等
2. 确保IIS已安装静态内容模块：
   - 打开"服务器管理器" -> "添加角色和功能"
   - 选择Web服务器(IIS) -> Web服务器 -> 常见HTTP功能 -> 静态内容
3. 配置IIS的URL重写规则，解决单页应用的路由问题：
   - 安装URL重写模块
   - 添加重写规则，将所有请求重定向到index.html
4. 检查应用池的.NET CLR版本是否设置为"无托管代码"
5. 检查文件夹权限，确保IIS_IUSRS组有读取权限

### 2.5 问题：权限控制功能异常

#### 2.5.1 问题描述
部署后，知识库的权限控制功能无法正常工作，用户无法访问已授权的知识库。

#### 2.5.2 解决方案
1. 检查后端API是否正常运行
2. 检查数据库连接字符串是否正确
3. 确保用户角色、部门等数据已正确导入数据库
4. 检查前端代码中的权限过滤逻辑是否正确
5. 清除浏览器缓存后重新测试

## 3. 部署成功验证

部署完成后，建议进行以下验证：

1. **访问验证**：打开浏览器访问站点URL，确认页面能正常加载
2. **功能验证**：测试核心功能，包括登录、知识库管理、权限控制等
3. **权限验证**：
   - 以不同角色用户登录，验证全局知识库的角色权限控制
   - 测试个人知识库的权限分配功能（按人员、部门、角色）
4. **性能验证**：检查页面加载速度、响应时间等性能指标
5. **安全性验证**：检查敏感信息是否加密、权限控制是否严格等

## 4. 部署优化建议

### 4.1 自动化部署
建议使用CI/CD工具（如Jenkins、GitHub Actions等）实现自动化部署，减少人工操作和错误。

### 4.2 环境隔离
建议为不同环境（开发、测试、生产）配置独立的服务器和数据库，确保环境隔离。

### 4.3 备份策略
建议定期备份数据库和部署文件，防止数据丢失。

### 4.4 监控系统
建议部署监控系统（如Prometheus、Grafana等），实时监控系统运行状态和性能指标。

### 4.5 灰度发布
建议实现灰度发布功能，逐步将新版本推向用户，降低发布风险。

## 5. 版本更新记录

| 版本号 | 更新日期 | 更新内容 | 部署人员 |
|-------|---------|---------|---------|
| 2.0.0 | 2025-01-30 | 初始版本部署 | 张三 |
| 2.0.1 | 2025-02-05 | 修复知识库权限控制功能 | 李四 |
